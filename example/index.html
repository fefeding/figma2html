<!doctype html>
<html>

<head>
	<meta content="text/html; charset=UTF-8" http-equiv="content-type" />
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<style>
		html,
		body {
			margin: 0;
			padding: 0;
		}

		#container {
			text-align: left;
			height: 100%;
			margin: auto;
			background-color: rgb(44, 44, 44);
			position: relative;
		}
		#container page {
			overflow: auto;
		}
		#container page > div {
			display: inline-block;
			position: relative;
			margin: 50px;
		}
	</style>
</head>

<body>
	
	<div id="container">
		<h1 style="color: #fff">加载中...</h1>
	</div>
</body>
<script type="module">
	import { convert, nodeToDom, util, loadFigmaFile, getFigmaImage, getFigmaFileImages } from "../dist/index.esm.js";
	
	const urlParams = getUrlParams();

	async function loadFigmaTemplate(id) {
		//const data = await loadFigmaFile(id, 'token');
		let data = await util.request('bg.json');
		if(typeof data === 'string') data = JSON.parse(data);
		console.log(data);
		return data;
	}

	async function renderTemplate() {
		const data = await loadFigmaTemplate();

		const images = await getFigmaFileImages(urlParams.fileid, urlParams.token);

		const tpl = await convert(data, null, {
			images
		});
		
		console.log(tpl);

		const container = document.getElementById('container');
		container.innerHTML = '';

		const node = await nodeToDom(tpl, {
			
		});
		//node.style.overflow = 'hidden';
		node && container.appendChild(node);
	}

	renderTemplate();

	function getUrlParams(url=location.href) {
		const urlParams = new URLSearchParams(url.split('?')[1]);
		const params = {};
		for (let param of urlParams.entries()) {
			params[param[0]] = param[1];
		}
		return params;
	}
</script>

</html>