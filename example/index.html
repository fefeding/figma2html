<!doctype html>
<html>

<head>
	<meta content="text/html; charset=UTF-8" http-equiv="content-type" />
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<style>
		html,
		body {
			margin: 0;
			padding: 0;
		}

		#container {
			text-align: center;
			height: 100%;
			margin: auto;
			background-color: #eee;
			position: relative;
		}

		#container page>div {
			display: block;
		}
	</style>
</head>

<body>
	
	<div id="container">
		<h1>加载中...</h1>
	</div>
</body>
<script type="module">
	import { convert, util, loadFigmaFile } from "../dist/index.esm.js";
	
	async function loadFigmaTemplate(id) {
		//const data = await loadFigmaFile(id, 'token');
		let data = await util.request('bg.json');
		if(typeof data === 'string') data = JSON.parse(data);
		console.log(data);
		return data;
	}

	async function renderTemplate() {
		const data = await loadFigmaTemplate();
		const tpl = await convert(data);
		
		const container = document.getElementById('container');
		container.innerHTML = '';

		const node = renderNode(tpl);
		//node.style.overflow = 'hidden';
		node && container.appendChild(node);
	}

	function renderNode(node) {
		switch(node.type) {
			case 'document': {
				return renderDocument(node);
			}
			case 'page': {
				return renderPage(node);
			}
			default: {
				return renderElement(node);
			}
		}
	}

	function renderDocument(node) {
		const doc = renderElement(node);
		return doc;
	}

	function renderPage(node) {
		const page = renderElement(node);
		page.style.minHeight = node.bounds.height + 'px';
		return page;
	}

	function renderElement(node) {
		const dom = document.createElement(node.type);
		if(node.style) {
			Object.assign(dom.style, node.style);
		}
		if(node.text) {
			dom.innerText = node.text;
		}

		if(node.name) dom.setAttribute('title', node.name);
		if(node.id) dom.setAttribute('data-id', node.id);

		if(node.children) {
			for(const child of node.children) {
				const c = renderNode(child);
				dom.appendChild(c);
			}
		}
		return dom;
	}

	renderTemplate();
</script>

</html>